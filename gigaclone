#!/bin/bash
set -e

dir="$PWD"
tmp="$dir/tmp"
copy="$dir/copy"
mkdir $tmp
cd $tmp
wget http://profile.gigaset.net/logs.tgz && tar -xzf logs.tgz

cd log
for f in ./*;do {
echo "Working... for $f"
sed -i '/.*404.*/d;/.*403.*/d;s/\sHTTP.*//g;s/.*\s/http:\/\/profile\.gigaset\.net/g;/http:\/\/profile\.gigaset\.net\"\"/d' $f
echo "Remove duplicates for $f"
awk '!seen[$0]++' $f >>$tmp/tmp.txt
};done

cd $dir
echo "Download everything."
wget -i $tmp/tmp.txt -x -N -nc
mv profile.gigaset.net $copy

wget https://copy.com/install/linux/Copy.tgz
tar xvzf Copy.tgz
cd copy/x86_64
./CopyConsole -u=$user -r=$copy -p=$pass
